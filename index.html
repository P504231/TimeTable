<!-- ----- HTML ----- -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Planner & Progress Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- ----- CSS ----- -->
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4efe9 100%);
            color: #2c3e50;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }
        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 60%);
            transform: rotate(30deg);
        }
        h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            letter-spacing: 0.5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        .date-range {
            font-size: 1.3rem;
            font-weight: 500;
            opacity: 0.9;
        }
        .current-task-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            font-weight: 500;
            color: #2c3e50;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            text-align: center;
        }
        .current-task-container .task-label {
            font-size: 1.2rem;
            font-weight: bold;
            color: #FF0000;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .current-task-container .animated-arrow {
            font-size: 1.8rem;
            color: #8B0000;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        .current-task-container .task-name {
            font-size: 2.4rem;
            font-weight: bold;
            color: #FF0000;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }
        .digital-stopwatch {
            font-family: 'Courier New', monospace;
            font-size: 1.8rem;
            font-weight: bold;
            color: #00008B;
            background: #CF9FFF;
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            min-width: 140px;
            text-align: center;
            animation: blink 1s step-end infinite;
        }
        @keyframes blink {
            50% { opacity: 0.7; }
        }
        .day-navigation {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        .day-btn {
            padding: 12px 22px;
            background: #6a11cb;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(106, 17, 203, 0.3);
        }
        .day-btn:hover {
            background: #2575fc;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(37, 117, 252, 0.4);
        }
        .day-btn.active {
            background: #2575fc;
            box-shadow: 0 0 0 3px rgba(37, 117, 252, 0.3);
        }
        .tables-container {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
        }
        .daily-table-container { flex: 2; min-width: 300px; }
        .overview-table-container { flex: 1; min-width: 300px; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 25px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        th, td {
            padding: 15px 18px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        th {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }
        tr:nth-child(even) { background-color: #f8f9fa; }
        tr:hover { background-color: #f1f3f5; }
        tr.completed {
            background-color: #d4edda !important;
            color: #155724;
        }
        .start-btn, .stop-btn {
            padding: 8px 16px;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            margin-left: 10px;
            font-weight: 600;
        }
        .start-btn {
            background: #2575fc;
        }
        .start-btn:hover {
            background: #6a11cb;
        }
        .start-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        .stop-btn {
            background: #dc3545;
        }
        .stop-btn:hover {
            background: #b02a37;
        }
        .timer-display {
            font-weight: bold;
            color: #2575fc;
            display: inline-block;
            min-width: 80px;
            text-align: right;
        }
        .timer-container {
            display: flex;
            align-items: center;
            justify-content: flex-start;
        }
        .done-cell {
            text-align: center;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .award-btn {
            background: #ffc107;
            color: #212529;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }
        .award-btn:hover {
            background: #e0a800;
            transform: scale(1.1);
        }
        .toggle-container {
            display: flex;
            justify-content: center;
            margin: 25px 0;
            gap: 15px;
        }
        .toggle-btn {
            padding: 12px 25px;
            background: #6a11cb;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(106, 17, 203, 0.3);
        }
        .toggle-btn:hover {
            background: #2575fc;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(37, 117, 252, 0.4);
        }
        .date-display {
            margin: 10px 0;
            font-size: 1.2rem;
            font-weight: 500;
            color: #2c3e50;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6a11cb, #2575fc);
            transition: width 0.3s ease;
        }
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 1000;
            pointer-events: none;
        }
        .celebration-message {
            font-size: 3rem;
            font-weight: bold;
            color: #2575fc;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            animation: zoom 2s ease-out;
        }
        @keyframes zoom {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .firework {
            position: absolute;
            border-radius: 50%;
            animation: explode 1s ease-out forwards;
        }
        @keyframes explode {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
        @media (max-width: 768px) {
            .tables-container { flex-direction: column; }
            .day-navigation { justify-content: flex-start; }
            h1 { font-size: 2.2rem; }
            .timer-display { min-width: 60px; }
            .start-btn, .stop-btn { margin-left: 5px; }
            .current-task-container {
                padding: 20px;
            }
            .current-task-container .task-label {
                font-size: 1rem;
            }
            .current-task-container .animated-arrow {
                font-size: 1.5rem;
            }
            .current-task-container .task-name {
                font-size: 2rem;
            }
            .digital-stopwatch {
                font-size: 1.5rem;
            }
        }
        @media (max-width: 480px) {
            .current-task-container .task-label {
                font-size: 0.8rem;
            }
            .current-task-container .animated-arrow {
                font-size: 1.2rem;
            }
            .current-task-container .task-name {
                font-size: 1.6rem;
            }
            .digital-stopwatch {
                font-size: 1.2rem;
                min-width: 100px;
                padding: 8px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Intense Revision Plan</h1>
            <div class="date-range">September 6 - 12, 2025</div>
        </header>
        
        <div class="current-task-container" id="current-task">
            <div>No task currently active</div>
        </div>
        
        <div class="day-navigation" id="day-navigation"></div>
        
        <div class="toggle-container">
            <button class="toggle-btn" id="toggle-view">Show Overall Performance</button>
        </div>
        
        <div class="tables-container">
            <div class="daily-table-container">
                <h2>Daily Study Schedule - <span id="current-day">Day 1</span></h2>
                <div class="date-display" id="current-date">September 6, 2025</div>
                <table id="daily-table">
                    <thead>
                        <tr>
                            <th>Activity</th>
                            <th>Timer</th>
                            <th>Done</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="overview-table-container" id="overview-container" style="display: none;">
                <h2>Day Overview</h2>
                <table id="overview-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Completed</th>
                            <th>Progress</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ----- JavaScript ----- -->
    <script>
        const studyPlan = { 
            days: [], 
            currentDay: 1, 
            showOverview: false,
            activeTaskIndex: null,
            activeTaskDay: null
        };
        let stopwatchInterval = null;

        function initializeStudyPlan() {
            const baseTasks = [
                { activity: 'Science', duration: 3600000, done: false, startTime: null, remainingTime: 3600000, timerInterval: null },
                { activity: 'Union and state budget', duration: 1800000, done: false, startTime: null, remainingTime: 1800000, timerInterval: null },
                { activity: 'Union and state economic survey', duration: 1800000, done: false, startTime: null, remainingTime: 1800000, timerInterval: null },
                { activity: 'National and International current affairs', duration: 3600000, done: false, startTime: null, remainingTime: 3600000, timerInterval: null },
                { activity: 'Bihar Special History', duration: 3600000, done: false, startTime: null, remainingTime: 3600000, timerInterval: null },
                { activity: 'Geography', duration: 3600000, done: false, startTime: null, remainingTime: 3600000, timerInterval: null },
                { activity: 'Polity', duration: 3600000, done: false, startTime: null, remainingTime: 3600000, timerInterval: null },
                { activity: 'Economics', duration: 1800000, done: false, startTime: null, remainingTime: 1800000, timerInterval: null }
            ];
            studyPlan.days = [];
            const startDate = new Date(2025, 8, 6); // Start from September 6, 2025
            for (let i = 0; i < 7; i++) { // 7 days for September 6 to 12
                const dayDate = new Date(startDate);
                dayDate.setDate(startDate.getDate() + i);
                dayDate.setHours(0, 0, 0, 0);
                const formattedDate = formatDate(dayDate);
                studyPlan.days.push({
                    dayNumber: i + 1,
                    date: dayDate,
                    formattedDate: formattedDate,
                    tasks: baseTasks.map(task => ({ ...task }))
                });
            }
        }

        function formatDate(date) {
            if (!(date instanceof Date) || isNaN(date)) {
                console.error('Invalid date in formatDate:', date);
                return 'Unknown Date';
            }
            const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            return `${months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
        }

        function formatTime(ms) {
            if (ms <= 0) return '00:00:00';
            const totalSeconds = Math.floor(ms / 1000);
            const h = Math.floor(totalSeconds / 3600);
            const m = Math.floor((totalSeconds % 3600) / 60);
            const s = totalSeconds % 60;
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function formatTimeShort(ms) {
            if (ms <= 0) return '00:00';
            const totalSeconds = Math.floor(ms / 1000);
            const m = Math.floor(totalSeconds / 60);
            const s = totalSeconds % 60;
            return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function isToday(dayDate) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            if (!(dayDate instanceof Date) || isNaN(dayDate)) {
                console.error('Invalid dayDate in isToday:', dayDate);
                return false;
            }
            const checkDate = new Date(dayDate.getTime());
            checkDate.setHours(0, 0, 0, 0);
            return (
                checkDate.getFullYear() === today.getFullYear() &&
                checkDate.getMonth() === today.getMonth() &&
                checkDate.getDate() === today.getDate()
            );
        }

        function updateCurrentTaskDisplay() {
            const currentTaskDiv = document.getElementById('current-task');
            
            if (studyPlan.activeTaskIndex !== null && studyPlan.activeTaskDay !== null) {
                const day = studyPlan.days[studyPlan.activeTaskDay - 1];
                const task = day.tasks[studyPlan.activeTaskIndex];
                const remaining = task.remainingTime || task.duration;
                
                currentTaskDiv.innerHTML = `
                    <div>
                        <div><span class="task-label">Currently Studying</span></div>
                        <div><span class="animated-arrow">‚ûî</span><span class="task-name">${task.activity}</span></div>
                        <div><span class="digital-stopwatch">${formatTime(remaining)}</span></div>
                    </div>
                `;
                
                if (stopwatchInterval) clearInterval(stopwatchInterval);
                stopwatchInterval = setInterval(() => {
                    if (studyPlan.activeTaskIndex !== null && studyPlan.activeTaskDay !== null) {
                        const updatedTask = studyPlan.days[studyPlan.activeTaskDay - 1].tasks[studyPlan.activeTaskIndex];
                        const updatedRemaining = updatedTask.remainingTime || updatedTask.duration;
                        currentTaskDiv.innerHTML = `
                            <div>
                                <div><span class="task-label">Currently Studying</span></div>
                                <div><span class="animated-arrow">‚ûî</span><span class="task-name">${updatedTask.activity}</span></div>
                                <div><span class="digital-stopwatch">${formatTime(updatedRemaining)}</span></div>
                            </div>
                        `;
                    }
                }, 1000);
            } else {
                currentTaskDiv.innerHTML = `<div>No task currently active</div>`;
                if (stopwatchInterval) clearInterval(stopwatchInterval);
            }
        }

        function generateDayNavigation() {
            const nav = document.getElementById('day-navigation');
            nav.innerHTML = '';
            studyPlan.days.forEach((day, index) => {
                const btn = document.createElement('button');
                btn.className = `day-btn ${studyPlan.currentDay === index + 1 ? 'active' : ''}`;
                btn.textContent = day.formattedDate.split(' ')[0] + ' ' + day.formattedDate.split(' ')[1].replace(',', '');
                btn.onclick = () => switchDay(index + 1);
                nav.appendChild(btn);
            });
        }

        function switchDay(day) {
            try {
                studyPlan.currentDay = day;
                const buttons = document.querySelectorAll('.day-btn');
                buttons.forEach((btn, idx) => {
                    btn.classList.toggle('active', idx + 1 === day);
                });
                document.getElementById('current-day').textContent = `Day ${day}`;
                document.getElementById('current-date').textContent = studyPlan.days[day - 1]?.formattedDate || 'Unknown Date';
                renderDailyTable();
                updateCurrentTaskDisplay();
                saveToLocalStorage();
            } catch (error) {
                console.error('Error in switchDay:', error);
            }
        }

        function renderDailyTable() {
            try {
                const tbody = document.querySelector('#daily-table tbody');
                tbody.innerHTML = '';
                const dayData = studyPlan.days[studyPlan.currentDay - 1];
                if (!dayData || !dayData.tasks) {
                    console.error('No dayData or tasks found for day:', studyPlan.currentDay);
                    tbody.innerHTML = '<tr><td colspan="3">No tasks available</td></tr>';
                    return;
                }
                const isCurrentDay = isToday(dayData.date);

                dayData.tasks.forEach((task, i) => {
                    const row = document.createElement('tr');
                    if (task.done) {
                        row.classList.add('completed');
                    }
                    const timerCell = document.createElement('td');
                    timerCell.classList.add('timer-cell');
                    timerCell.dataset.index = i;
                    const doneCell = document.createElement('td');
                    doneCell.classList.add('done-cell');
                    
                    const awardBtn = document.createElement('button');
                    awardBtn.className = 'award-btn';
                    awardBtn.innerHTML = 'üèÜ';
                    awardBtn.title = 'Celebrate completion';
                    awardBtn.onclick = () => celebrateCompletion();
                    
                    if (task.done) {
                        doneCell.innerHTML = '‚úîÔ∏è';
                        doneCell.appendChild(awardBtn);
                    } else {
                        doneCell.textContent = '';
                    }
                    
                    row.innerHTML = `<td>${task.activity}</td>`;
                    row.appendChild(timerCell);
                    row.appendChild(doneCell);
                    tbody.appendChild(row);

                    if (task.done) {
                        timerCell.textContent = 'Completed';
                    } else if (isCurrentDay) {
                        const isRunning = studyPlan.activeTaskIndex === i && studyPlan.activeTaskDay === studyPlan.currentDay;
                        const remaining = task.remainingTime || task.duration;
                        timerCell.innerHTML = `
                            <div class="timer-container">
                                <span class="timer-display" data-index="${i}">${formatTimeShort(remaining)}</span>
                                ${isRunning ? 
                                    `<button class="stop-btn" data-index="${i}">Stop</button>` :
                                    `<button class="start-btn" data-index="${i}" ${studyPlan.activeTaskIndex !== null && studyPlan.activeTaskIndex !== i ? 'disabled' : ''}>Start</button>`}
                            </div>`;
                    } else {
                        timerCell.textContent = 'Not Started';
                    }
                });

                document.querySelectorAll('.start-btn').forEach(btn => {
                    btn.onclick = () => handleStart(parseInt(btn.dataset.index));
                });
                document.querySelectorAll('.stop-btn').forEach(btn => {
                    btn.onclick = () => handleStop(parseInt(btn.dataset.index));
                });
            } catch (error) {
                console.error('Error in renderDailyTable:', error);
                document.querySelector('#daily-table tbody').innerHTML = '<tr><td colspan="3">Error loading tasks</td></tr>';
            }
        }

        function handleStart(i) {
            try {
                if (studyPlan.activeTaskIndex !== null) return;
                const day = studyPlan.days[studyPlan.currentDay - 1];
                const t = day.tasks[i];
                if (!t.done) {
                    if (!t.startTime) {
                        t.startTime = Date.now();
                        t.remainingTime = t.duration;
                    }
                    studyPlan.activeTaskIndex = i;
                    studyPlan.activeTaskDay = studyPlan.currentDay;
                    saveToLocalStorage();
                    startTimer(i);
                    renderDailyTable();
                    updateCurrentTaskDisplay();
                }
            } catch (error) {
                console.error('Error in handleStart:', error);
            }
        }

        function handleStop(i) {
            try {
                const day = studyPlan.days[studyPlan.activeTaskDay - 1];
                const t = day.tasks[i];
                if (t.timerInterval) {
                    clearInterval(t.timerInterval);
                    t.timerInterval = null;
                }
                t.remainingTime = t.duration - (Date.now() - t.startTime);
                if (t.remainingTime <= 0) {
                    completeTask(i);
                } else {
                    studyPlan.activeTaskIndex = null;
                    studyPlan.activeTaskDay = null;
                    saveToLocalStorage();
                    renderDailyTable();
                    updateCurrentTaskDisplay();
                }
            } catch (error) {
                console.error('Error in handleStop:', error);
            }
        }

        function startTimer(i) {
            try {
                const day = studyPlan.days[studyPlan.activeTaskDay - 1];
                const t = day.tasks[i];
                let r = t.remainingTime || t.duration;
                updateTimerUI(i, r);
                updateCurrentTaskDisplay();
                const int = setInterval(() => {
                    r = t.duration - (Date.now() - t.startTime);
                    if (r <= 0) {
                        clearInterval(int);
                        t.timerInterval = null;
                        completeTask(i);
                    } else {
                        t.remainingTime = r;
                        updateTimerUI(i, r);
                        updateCurrentTaskDisplay();
                        saveToLocalStorage();
                    }
                }, 1000);
                t.timerInterval = int;
            } catch (error) {
                console.error('Error in startTimer:', error);
            }
        }

        function updateTimerUI(i, r) {
            try {
                if (studyPlan.currentDay === studyPlan.activeTaskDay) {
                    const disp = document.querySelector(`.timer-display[data-index="${i}"]`);
                    if (disp) {
                        disp.textContent = formatTimeShort(r);
                    }
                }
            } catch (error) {
                console.error('Error in updateTimerUI:', error);
            }
        }

        function completeTask(i) {
            try {
                const d = studyPlan.days[studyPlan.activeTaskDay - 1];
                const t = d.tasks[i];
                if (t.timerInterval) {
                    clearInterval(t.timerInterval);
                    t.timerInterval = null;
                }
                t.done = true;
                t.startTime = null;
                t.remainingTime = t.duration;
                studyPlan.activeTaskIndex = null;
                studyPlan.activeTaskDay = null;
                saveToLocalStorage();
                if (studyPlan.currentDay === d.dayNumber) {
                    const tc = document.querySelector(`.timer-cell[data-index="${i}"]`);
                    if (tc) tc.textContent = 'Completed';
                    renderDailyTable();
                }
                updateCurrentTaskDisplay();
            } catch (error) {
                console.error('Error in completeTask:', error);
            }
        }

        function celebrateCompletion() {
            const celebration = document.createElement('div');
            celebration.className = 'celebration';
            
            const message = document.createElement('div');
            message.className = 'celebration-message';
            message.textContent = 'Well Done üëè';
            celebration.appendChild(message);
            
            document.body.appendChild(celebration);
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.style.left = Math.random() * 100 + 'vw';
                    firework.style.top = Math.random() * 100 + 'vh';
                    firework.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                    firework.style.width = (Math.random() * 20 + 10) + 'px';
                    firework.style.height = firework.style.width;
                    celebration.appendChild(firework);
                    
                    setTimeout(() => {
                        firework.remove();
                    }, 1000);
                }, i * 50);
            }
            
            setTimeout(() => {
                celebration.remove();
            }, 2000);
        }

        function renderOverviewTable() {
            try {
                const tbody = document.querySelector('#overview-table tbody');
                tbody.innerHTML = '';
                studyPlan.days.forEach(day => {
                    const comp = day.tasks.filter(t => t.done).length;
                    const tot = day.tasks.length;
                    const per = Math.round((comp / tot) * 100);
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${day.formattedDate}</td>
                        <td>${comp}/${tot}</td>
                        <td><div class="progress-bar"><div class="progress-fill" style="width:${per}%"></div></div></td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error in renderOverviewTable:', error);
            }
        }

        function toggleView() {
            try {
                studyPlan.showOverview = !studyPlan.showOverview;
                const show = studyPlan.showOverview;
                document.querySelector('.daily-table-container').style.display = show ? 'none' : 'block';
                document.getElementById('overview-container').style.display = show ? 'block' : 'none';
                document.getElementById('toggle-view').textContent = show ? 'Show Daily Schedule' : 'Show Overall Performance';
                if (show) renderOverviewTable();
                saveToLocalStorage();
            } catch (error) {
                console.error('Error in toggleView:', error);
            }
        }

        function saveToLocalStorage() {
            try {
                const serializablePlan = {
                    ...studyPlan,
                    days: studyPlan.days.map(day => ({
                        ...day,
                        date: day.date.toISOString(),
                        tasks: day.tasks.map(task => ({
                            ...task,
                            startTime: task.startTime,
                            remainingTime: task.remainingTime,
                            timerInterval: null
                        }))
                    }))
                };
                localStorage.setItem('studyPlan', JSON.stringify(serializablePlan));
            } catch (error) {
                console.error('Error in saveToLocalStorage:', error);
            }
        }

        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('studyPlan');
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    const days = parsedData.days.map(day => ({
                        ...day,
                        date: new Date(day.date),
                        tasks: day.tasks.map(task => ({
                            ...task,
                            startTime: task.startTime ? new Date(task.startTime) : null,
                            remainingTime: task.remainingTime || task.duration,
                            timerInterval: null
                        }))
                    }));
                    if (days.length === 7 && days[0].date.getFullYear() === 2025 && days[0].date.getMonth() === 8 && days[0].date.getDate() === 6) {
                        studyPlan.days = days;
                        studyPlan.currentDay = parsedData.currentDay || 1;
                        studyPlan.showOverview = parsedData.showOverview || false;
                        studyPlan.activeTaskIndex = parsedData.activeTaskIndex;
                        studyPlan.activeTaskDay = parsedData.activeTaskDay;
                        if (studyPlan.activeTaskIndex !== null && studyPlan.activeTaskDay !== null) {
                            const task = studyPlan.days[studyPlan.activeTaskDay - 1].tasks[studyPlan.activeTaskIndex];
                            if (task.startTime) {
                                startTimer(studyPlan.activeTaskIndex);
                            } else {
                                studyPlan.activeTaskIndex = null;
                                studyPlan.activeTaskDay = null;
                            }
                        }
                    } else {
                        console.warn('Invalid data in localStorage, resetting study plan');
                        localStorage.removeItem('studyPlan');
                        initializeStudyPlan();
                    }
                } else {
                    initializeStudyPlan();
                }
            } catch (error) {
                console.error('Error in loadFromLocalStorage:', error);
                localStorage.removeItem('studyPlan');
                initializeStudyPlan();
            }
        }

        function initApp() {
            try {
                loadFromLocalStorage();
                if (studyPlan.days.length === 0) {
                    initializeStudyPlan();
                }
                generateDayNavigation();
                switchDay(studyPlan.currentDay);
                if (studyPlan.showOverview) {
                    toggleView();
                }
                document.getElementById('toggle-view').addEventListener('click', toggleView);
                updateCurrentTaskDisplay();
            } catch (error) {
                console.error('Error in initApp:', error);
                document.querySelector('#daily-table tbody').innerHTML = '<tr><td colspan="3">Error initializing app</td></tr>';
            }
        }

        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
